<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>多人博客项目Review | 猪脚面线的知识库</title>
    <meta name="description" content="For what it&#39;s worth, it&#39;s never too late.（Updating... XD）">
    <link rel="icon" href="/isaacgaoblog/logo.ico">
    
    <link rel="preload" href="/isaacgaoblog/assets/css/0.styles.60655061.css" as="style"><link rel="preload" href="/isaacgaoblog/assets/js/app.01da7489.js" as="script"><link rel="preload" href="/isaacgaoblog/assets/js/23.4ecf9c22.js" as="script"><link rel="prefetch" href="/isaacgaoblog/assets/js/10.bb6e04e4.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/11.391fd545.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/12.602facc5.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/13.2d9982a6.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/14.83aaa352.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/15.90b7ef7b.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/16.fb97507d.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/17.d2fb61a5.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/18.5f85ae3a.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/19.b706601e.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/2.3704caf5.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/20.66d4ff5f.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/21.341d678b.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/22.3af63f24.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/24.15a6c94a.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/25.bc5a5667.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/26.823bab78.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/27.0327437d.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/28.db82409c.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/29.e695a449.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/3.98b19d1d.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/4.4d6e9538.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/5.44d0334a.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/6.b35e585c.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/7.723d1e3a.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/8.e2bfc8ff.js"><link rel="prefetch" href="/isaacgaoblog/assets/js/9.508f61f1.js">
    <link rel="stylesheet" href="/isaacgaoblog/assets/css/0.styles.60655061.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/isaacgaoblog/" class="home-link router-link-active"><!----> <span class="site-name">猪脚面线的知识库</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/isaacgaoblog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/isaacgaoblog/article/frontend/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/isaacgaoblog/article/backend/" class="nav-link">后端</a></li></ul></div></div><div class="nav-item"><a href="/isaacgaoblog/posts/" class="nav-link router-link-active">博文</a></div><div class="nav-item"><a href="https://www.github.com/Cobatkao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/isaacgaoblog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/isaacgaoblog/article/frontend/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/isaacgaoblog/article/backend/" class="nav-link">后端</a></li></ul></div></div><div class="nav-item"><a href="/isaacgaoblog/posts/" class="nav-link router-link-active">博文</a></div><div class="nav-item"><a href="https://www.github.com/Cobatkao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>博文</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/isaacgaoblog/posts/" class="sidebar-link">碎碎念</a></li><li><a href="/isaacgaoblog/posts/布局全解.html" class="sidebar-link">布局全解</a></li><li><a href="/isaacgaoblog/posts/重绘与重排.html" class="sidebar-link">重绘与重排</a></li><li><a href="/isaacgaoblog/posts/小白也可以搞懂的闭包.html" class="sidebar-link">小白也可以搞懂的闭包</a></li><li><a href="/isaacgaoblog/posts/小白上手Promise.html" class="sidebar-link">小白上手Promise</a></li><li><a href="/isaacgaoblog/posts/多人博客项目review.html" class="active sidebar-link">多人博客项目Review</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/isaacgaoblog/posts/多人博客项目review.html#项目初始化" class="sidebar-link">项目初始化</a></li><li class="sidebar-sub-header"><a href="/isaacgaoblog/posts/多人博客项目review.html#引入elementui" class="sidebar-link">引入ElementUI</a></li><li class="sidebar-sub-header"><a href="/isaacgaoblog/posts/多人博客项目review.html#📦-底层接口封装" class="sidebar-link">📦 底层接口封装</a></li><li class="sidebar-sub-header"><a href="/isaacgaoblog/posts/多人博客项目review.html#vuex" class="sidebar-link">VUEX</a></li><li class="sidebar-sub-header"><a href="/isaacgaoblog/posts/多人博客项目review.html#完善路由：元信息与路由守卫" class="sidebar-link">完善路由：元信息与路由守卫</a></li><li class="sidebar-sub-header"><a href="/isaacgaoblog/posts/多人博客项目review.html#技巧-其它" class="sidebar-link">技巧&amp;其它</a></li></ul></li><li><a href="/isaacgaoblog/posts/前端必须知道的HTTP缓存.html" class="sidebar-link">前端必须知道的HTTP缓存</a></li><li><a href="/isaacgaoblog/posts/从封装两个函数到入门jQuery.html" class="sidebar-link">从封装两个函数到入门jQuery</a></li><li><a href="/isaacgaoblog/posts/webpack4初次上手.html" class="sidebar-link">初次上手webpack4</a></li><li><a href="/isaacgaoblog/posts/Vue.2.x全家桶学习手记.html" class="sidebar-link">使用语雀整理Vue笔记</a></li><li><a href="/isaacgaoblog/posts/HTTPS通信机制.html" class="sidebar-link">HTTPS通信机制</a></li><li><a href="/isaacgaoblog/posts/Event_Loop和任务队列.html" class="sidebar-link">前端必须知道的Event Loop</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><blockquote><p>本项目做一款多人共享博客，包含首页、用户文章列表、登录、注册、个人管理、编辑、发布等功能。使用 Vue.js 技术栈：vue-cli/vue2.x/ElementUI/axios/vue-router/vuex/es6/npm</p></blockquote> <p>测试账号：huanghuang</p> <p>密码：12345678</p> <p>源码地址：https://github.com/Cobatkao/vue-blog-client</p> <p>打包地址：https://github.com/Cobatkao/vue-blog-preview</p> <p>线上预览地址：http://isaacgao.cn/vue-blog-preview/#/</p> <p>通过这个项目，我对Vue及其生态有了一个相对全面的了解与实践。</p> <p>下面，我来分块阐述下项目思路与逻辑。</p> <h2 id="项目初始化"><a href="#项目初始化" aria-hidden="true" class="header-anchor">#</a> 项目初始化</h2> <p>第一步，利用vue-cli配合webpack生成项目模板，并配置单页应用路由</p> <h3 id="vue-cli"><a href="#vue-cli" aria-hidden="true" class="header-anchor">#</a> vue-cli</h3> <p>通过vue-cli创建项目模板，这是我对vue-cli的笔记，<a href="http://note.youdao.com/noteshare?id=4fe677ce7a956ceaa7eb981097011048" target="_blank" rel="noopener noreferrer">vue-cli 点击查看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="vue-router"><a href="#vue-router" aria-hidden="true" class="header-anchor">#</a> vue-router</h3> <p>这一步我们要做的就是将对应分页的组件映射到路由，然后告诉路由在哪里渲染组件。</p> <p><strong>做法</strong>：在router/index.js中引入路由模块，注入路由供全局使用（<code>Vue.use(Router)</code>），实例化路由组件（<code>var router = new VueRouter({...})</code>）并配置路由<code>var routes = [{...}, {...}]</code>，再把实例化的路由加入Vue的对象实例中。最后，我们在App.vue（页面主模板）中添加路由出口（<code>router-view</code>）</p> <p>更多和路由配置有关的细节内容，请见我对vue-router的笔记，<a href="http://note.youdao.com/noteshare?id=2d8925a19d4ae7f839cc8e647384baaf" target="_blank" rel="noopener noreferrer">Vue Router 点击查看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="引入elementui"><a href="#引入elementui" aria-hidden="true" class="header-anchor">#</a> 引入ElementUI</h2> <p>具体使用请参阅<a href="http://element-cn.eleme.io/#/zh-CN" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>❤️ 既可以全局引入也可以按需引入</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// main.js中全局引入
import ElementUI from 'element-ui';
import 'element-ui/lib/theme-chalk/index.css';

Vue.use(ElementUI)


// 按需引入，只引入Message模块
import { Message } from 'element-ui'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>愉快的使用ElementUI吧～</p> <h2 id="📦-底层接口封装"><a href="#📦-底层接口封装" aria-hidden="true" class="header-anchor">#</a> 📦 底层接口封装</h2> <p>写了/helpers/request.js文件针对axios底层的GET、POST方法进行封装。为什么要这么做呢？</p> <ul><li>实现基于axios请求的底层的共有函数，方便具体业务代码的实现，也让代码更简洁，易维护</li> <li>在封装的request方法中返回了Promise，方便调用者then，catch，并且能响应错误</li></ul> <p>也就是说，如果你封装了一个数据请求方法，其它文件要获取数据，只要调用你提供的方法即可，这个方法可能引入elementUI更人性化报错信息，更实用的参数等等。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token comment">// 按需引入element-ui中的message组件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>


axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>post<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/x-www-form-urlencoded'</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'http://blog-server.hunger-valley.com'</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">'GET'</span><span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
      url<span class="token punctuation">,</span>
      method<span class="token punctuation">:</span> type
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      option<span class="token punctuation">.</span>params <span class="token operator">=</span> data
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      option<span class="token punctuation">.</span>data <span class="token operator">=</span> data
    <span class="token punctuation">}</span>
    <span class="token function">axios</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// status是成功的约定</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'ok'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// status = fail</span>
        Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'网络异常'</span><span class="token punctuation">)</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>msg<span class="token punctuation">:</span> <span class="token string">'网络异常'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>项目中我们封装了axios的get，post方法，暴露出request方法，供/api/blog.js和/api/auth.js进一步封装各个场景业务方法，如注册、登陆、获取信息、注销及对博客的增删改查等等。这部分代码见<code>/api</code>目录。</p> <h2 id="vuex"><a href="#vuex" aria-hidden="true" class="header-anchor">#</a> VUEX</h2> <p>在本项目中，我们运用vuex管理各个场景下公用的状态。</p> <h3 id="第一步"><a href="#第一步" aria-hidden="true" class="header-anchor">#</a> 第一步</h3> <p>对状态进行了分模块分类管理。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>└── store
    ├── entry.js //引入vuex，子模块，并实例化`Vuex.Store`
    └── modules
        ├── auth.js //负责用户注册、登录状态
        └── blog.js //负责用户获取、发布、修改博客等
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>首先，在entry.js中引入了vuex，并将实例化的Vuex.Store()构造器export出去，随后在main.js下引入store，<code>import store from './store/entry'</code> ,并配置到vue实例中，这样页面就可以使用vuex。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//entry.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> auth <span class="token keyword">from</span> <span class="token string">'./modules/auth'</span>
<span class="token keyword">import</span> blog <span class="token keyword">from</span> <span class="token string">'./modules/blog'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token comment">//创建全局vuex对象，暴露供全局vue使用</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    auth<span class="token punctuation">,</span>
    blog
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//main.js</span>
<span class="token operator">...</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/entry'</span>
<span class="token operator">...</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  router<span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span><span class="token punctuation">,</span>
  template<span class="token punctuation">:</span> <span class="token string">'&lt;App/&gt;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="第二步"><a href="#第二步" aria-hidden="true" class="header-anchor">#</a> 第二步</h3> <p>将负责登陆，注册及检测状态的state写在/store/modules/auth.js下，<a href="https://github.com/Cobatkao/vue-blog-client/blob/master/src/store/modules/auth.js" target="_blank" rel="noopener noreferrer">点击查看—auth.js项目代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>mutations用于修改state中的user，isLogin</li> <li>actions调用了/api/auth.js中与登陆相关的方法来供业务组件使用</li> <li>❤️这里使用了async&amp;await来简化promise链操作</li> <li>因为async是基于promise的，所以业务组件中调用如<code>login</code>方法，都可以继续then，catch</li></ul> <h3 id="第三步"><a href="#第三步" aria-hidden="true" class="header-anchor">#</a> 第三步</h3> <p>在业务组件中映射actions，并commit更新状态。</p> <p>这里我们把<code>/store/modules/auth.js</code>中的<code>login</code>映射到<code>pages/Login/template.js</code>的methods内，供页面模板触发事件处理函数。</p> <p>整个逻辑是：页面上点击button，调用<code>/store/modules/auth.js</code>中的<code>login</code>，完成登陆交互后，更新state中的数据，并且将数据响应到需要的组件来更新状态：如<code>headers.vue</code>需要读取<code>isLogin</code>来切换登陆态样式。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      username<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      password<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">onLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 跳至首页</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>redirect <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ol><li>所谓的映射就是用到了vuex的辅助函数：<code>mapActions</code>，将方法展开到login组件中</li> <li>然后<code>this.login(...)</code>就可以调用<code>auth.js</code>中的方法了</li></ol> <h3 id="第四步"><a href="#第四步" aria-hidden="true" class="header-anchor">#</a> 第四步</h3> <p>在组件模板中设置点击/input事件，触发并执行<code>onLogin</code> ——&gt; 调用<code>this.login</code>，执行<code>auth.login({ username, password })</code>，发起axios请求异步数据 ——&gt; 异步数据到来后commit状态，更新state数据 ——&gt; 最后重定向到首页，<code>this.$router.push({path: this.$route.query.redirect || '/'})</code>。</p> <h3 id="第五步"><a href="#第五步" aria-hidden="true" class="header-anchor">#</a> 第五步</h3> <p>header组件的登陆态切换。</p> <p>在Header.vue中，登录和未登录，他的样式在两种状态下是不一样的。</p> <p><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fxlgwnli2oj30x302t0t2.jpg" alt="pic"></p> <p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fxlgwkgtl7j30x20akgm9.jpg" alt="pic"></p> <p>如何实现两种状态的切换呢？当然是靠vuex了。</p> <p>在<code>/components/header.vue</code>中，我们还是引入了vuex辅助函数映射</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
        mapGetters<span class="token punctuation">,</span>
        mapActions
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一种是<code>...mapGetters(['isLogin', 'user'])</code>，获取状态；另一种是<code>...mapActions(['checkLogin', 'logout'])</code>，方便在页面还未挂载，渲染时检查state中用户登录状态，用户已登录，则返回 isLogin = true ，获取用户信息，渲染到页面上；用户未登录，则返回 isLogin = false，展示登陆注册框。</p> <p>具体代码，<a href="https://github.com/Cobatkao/vue-blog-client/blob/master/src/components/header.vue" target="_blank" rel="noopener noreferrer">查看/components/header.vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>以上是使用vuex在项目中管理登陆相关状态的笔记。</p> <h2 id="完善路由：元信息与路由守卫"><a href="#完善路由：元信息与路由守卫" aria-hidden="true" class="header-anchor">#</a> 完善路由：元信息与路由守卫</h2> <p>项目中，某些页面在跳转时需要或者在上个页面中用户是否登陆，才能操作，否则将自定转到登陆注册页面，如添加，修改，提交文章等，这时候我们就要用路由元信息，添加一小段内容来在导航时对路径做状态检查，从总路口来解决。</p> <p>在路由配置文件<code>router/index.js</code>中，我们给需要的路由配置一个meta属性，<code>meta: { requiresAuth: true }</code>，这段路由匹配到的路由记录会被暴露为<a href="https://router.vuejs.org/zh/api/#%E8%B7%AF%E7%94%B1%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7" target="_blank" rel="noopener noreferrer"><code>$route</code>对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (还有在导航守卫中的路由对象)的<code>$route.matched</code>数组：一个数组，包含当前路由的所有嵌套路径片段的路由记录 。</p> <p>通过遍历<code>$route.matched</code>来检查路由记录中的meta字段，对访问的路径做一个状态检查，从而确定是否允许访问。</p> <h2 id="技巧-其它"><a href="#技巧-其它" aria-hidden="true" class="header-anchor">#</a> 技巧&amp;其它</h2> <h3 id="async-await"><a href="#async-await" aria-hidden="true" class="header-anchor">#</a> async&amp;await</h3> <p>async的出现是为了解决多个Promise的同步操作，就像promise要解决回调函数的层层嵌套一样。</p> <p>所以async/await就是要完善Promise还不够完美的地方，是在Promise的基础上进行改进的，因此也很好理解为什么await只能“等待”Promise对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// promise写法</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> auth<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setUser'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> res<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setLogin'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> isLogin<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// async&amp;await改写</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//用户登录</span>
  <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> auth<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setUser'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> res<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setLogin'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> isLogin<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span>data
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>具体关于async&amp;await请参见我写的这篇笔记：<a href="http://note.youdao.com/noteshare?id=3c49e33bab38f6acad9c5408766620d7" target="_blank" rel="noopener noreferrer">async&amp;await 笔记<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="路由懒加载"><a href="#路由懒加载" aria-hidden="true" class="header-anchor">#</a> 路由懒加载</h3> <p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fxkhbh3yr7j30870cywfh.jpg" alt="pic"></p> <p>你可以在上图中发现项目打包后会变成vendor.js,0.xxxx.js,1.xxxx.js,2.xxxx.js ，每一个路由都会变成一个文件，项目在打开对应路由对应组件时候，才会加载对应的js（恩，这就是我想要的滑板鞋）。实现方式其实很简单，在路由文件中用这样的方式定义</p> <p><strong>为什么用路由懒加载</strong></p> <p>降低页面初次加载时间，减少流量消耗。</p> <p><strong>怎么用</strong></p> <p>两种风格：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>component: () =&gt; import('@/pages/Index/template.vue')
// const UserIndex = resolve =&gt; require(['@/components/UserIndex'], resolve)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/isaacgaoblog/assets/js/app.01da7489.js" defer></script><script src="/isaacgaoblog/assets/js/23.4ecf9c22.js" defer></script>
  </body>
</html>
